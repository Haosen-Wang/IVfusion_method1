Epoch 1/5:   5%|███▊                                                                   | 48/904 [01:00<01:09, 12.25it/s]
当前学习率: 0.001000
⚠️  批次 20 检测到 NaN/Inf 损失，跳过此批次...
损失详情: {'total_loss_f': tensor(nan, device='cuda:2', grad_fn=<AddBackward0>), 'pixel_loss': tensor(nan, device='cuda:2', grad_fn=<AddBackward0>), 'gradient_loss': tensor(nan, device='cuda:2', grad_fn=<AddBackward0>), 'perceptual_loss': tensor(nan, device='cuda:2', grad_fn=<AddBackward0>), 'total_loss_vi': tensor(nan, device='cuda:2', grad_fn=<MulBackward0>), 'rec_i': tensor(nan, device='cuda:2', grad_fn=<MseLossBackward0>), 'rec_g': tensor(nan, device='cuda:2', grad_fn=<MseLossBackward0>), 'kl_loss_i': tensor(nan, device='cuda:2', grad_fn=<MulBackward0>), 'kl_loss_g': tensor(nan, device='cuda:2', grad_fn=<MulBackward0>), 'total_loss': tensor(nan, device='cuda:2', grad_fn=<AddBackward0>)}
⚠️  批次 21 内存不足，跳过...
⚠️  批次 22 内存不足，跳过...
⚠️  批次 23 内存不足，跳过...
⚠️  批次 24 内存不足，跳过...
⚠️  批次 25 内存不足，跳过...
⚠️  批次 26 内存不足，跳过...
⚠️  批次 27 内存不足，跳过...
⚠️  批次 28 内存不足，跳过...
⚠️  批次 29 内存不足，跳过...
⚠️  批次 30 内存不足，跳过...
⚠️  批次 31 内存不足，跳过...
⚠️  批次 32 内存不足，跳过...
⚠️  批次 33 内存不足，跳过...
⚠️  批次 34 内存不足，跳过...
⚠️  批次 35 内存不足，跳过...
⚠️  批次 36 内存不足，跳过...
⚠️  批次 37 内存不足，跳过...
⚠️  批次 38 内存不足，跳过...
⚠️  批次 39 内存不足，跳过...
⚠️  批次 40 内存不足，跳过...
⚠️  批次 41 内存不足，跳过...
⚠️  批次 42 内存不足，跳过...
⚠️  批次 43 内存不足，跳过...
⚠️  批次 44 内存不足，跳过...
⚠️  批次 45 内存不足，跳过...
⚠️  批次 46 内存不足，跳过...
⚠️  批次 47 内存不足，跳过...
⚠️  批次 48 内存不足，跳过...
⚠️  批次 49 内存不足，跳过...
⚠️  批次 50 内存不足，跳过...
⚠️  批次 51 内存不足，跳过...
⚠️  批次 52 内存不足，跳过...
⚠️  批次 53 内存不足，跳过...
⚠️  批次 54 内存不足，跳过...
⚠️  批次 55 内存不足，跳过...
⚠️  批次 56 内存不足，跳过...
⚠️  批次 57 内存不足，跳过...
⚠️  批次 58 内存不足，跳过...
⚠️  批次 59 内存不足，跳过...
⚠️  批次 60 内存不足，跳过...
⚠️  批次 61 内存不足，跳过...
⚠️  批次 62 内存不足，跳过...
⚠️  批次 63 内存不足，跳过...
⚠️  批次 64 内存不足，跳过...
⚠️  批次 65 内存不足，跳过...
⚠️  批次 66 内存不足，跳过...
⚠️  批次 67 内存不足，跳过...
⚠️  批次 68 内存不足，跳过...
⚠️  批次 69 内存不足，跳过...
⚠️  批次 70 内存不足，跳过...
⚠️  批次 71 内存不足，跳过...
⚠️  批次 72 内存不足，跳过...
⚠️  批次 73 内存不足，跳过...
⚠️  批次 74 内存不足，跳过...
⚠️  批次 75 内存不足，跳过...
⚠️  批次 76 内存不足，跳过...
⚠️  批次 77 内存不足，跳过...
⚠️  批次 78 内存不足，跳过...
⚠️  批次 79 内存不足，跳过...
⚠️  批次 80 内存不足，跳过...
⚠️  批次 81 内存不足，跳过...
⚠️  批次 82 内存不足，跳过...
⚠️  批次 83 内存不足，跳过...
⚠️  批次 84 内存不足，跳过...
⚠️  批次 85 内存不足，跳过...
⚠️  批次 86 内存不足，跳过...
Traceback (most recent call last):
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 420, in <module>
    main(**config_dic)
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 383, in main
    best_epoch, best_loss = train_model(
                            ^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 137, in train_model
    epoch_loss = train_epoch_model(model, train_loader, criterion, optimizer, device_1, device_2, device_3, val_loader, pbar)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 39, in train_epoch_model
    output, l, g, mu_l, sigma2_l, mu_g, sigma2_g = model(i_image, v_image, device_1, device_2, device_3)
                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/model.py", line 43, in forward
    l,mu_l,sigma2_l = self.I_encoder_decoder(i)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/model.py", line 17, in forward
    x=self.encoder(x)
      ^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/component.py", line 19, in forward
    x=self.model(x)
      ^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/container.py", line 240, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/../restormer/restormer_arch.py", line 242, in forward
    out_enc_level1 = self.encoder_level1(inp_enc_level1)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/container.py", line 240, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/../restormer/restormer_arch.py", line 141, in forward
    x = x + self.attn(self.norm1(x))
            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/../restormer/restormer_arch.py", line 115, in forward
    q = torch.nn.functional.normalize(q, dim=-1)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/functional.py", line 5486, in normalize
    denom = input.norm(p, dim, keepdim=True).clamp_min(eps).expand_as(input)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/_tensor.py", line 894, in norm
    return torch.norm(self, p, dim, keepdim, dtype=dtype)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/functional.py", line 1849, in norm
    return torch.linalg.vector_norm(input, _p, _dim, keepdim, dtype=dtype)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
