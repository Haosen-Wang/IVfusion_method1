Epoch 1/20:  12%|████████▌                                                            | 112/904 [02:02<06:39,  1.98it/s]
当前学习率: 0.001000
⚠️  批次 82 内存不足，跳过...
⚠️  批次 83 内存不足，跳过...
⚠️  批次 84 内存不足，跳过...
⚠️  批次 85 内存不足，跳过...
⚠️  批次 86 内存不足，跳过...
⚠️  批次 87 内存不足，跳过...
⚠️  批次 88 内存不足，跳过...
⚠️  批次 89 内存不足，跳过...
⚠️  批次 90 内存不足，跳过...
⚠️  批次 91 内存不足，跳过...
⚠️  批次 92 内存不足，跳过...
⚠️  批次 93 内存不足，跳过...
⚠️  批次 94 内存不足，跳过...
⚠️  批次 95 内存不足，跳过...
⚠️  批次 96 内存不足，跳过...
⚠️  批次 97 内存不足，跳过...
⚠️  批次 98 内存不足，跳过...
⚠️  批次 99 内存不足，跳过...
⚠️  批次 100 内存不足，跳过...
⚠️  批次 101 内存不足，跳过...
⚠️  批次 102 内存不足，跳过...
⚠️  批次 103 内存不足，跳过...
⚠️  批次 104 内存不足，跳过...
⚠️  批次 105 内存不足，跳过...
⚠️  批次 106 内存不足，跳过...
⚠️  批次 107 内存不足，跳过...
⚠️  批次 108 内存不足，跳过...
⚠️  批次 109 内存不足，跳过...
⚠️  批次 110 内存不足，跳过...
⚠️  批次 111 内存不足，跳过...
⚠️  批次 112 内存不足，跳过...
⚠️  批次 113 内存不足，跳过...
⚠️  批次 114 内存不足，跳过...
⚠️  批次 115 内存不足，跳过...
⚠️  批次 116 内存不足，跳过...
⚠️  批次 117 内存不足，跳过...
⚠️  批次 118 内存不足，跳过...
⚠️  批次 119 内存不足，跳过...
⚠️  批次 120 内存不足，跳过...
⚠️  批次 121 内存不足，跳过...
⚠️  批次 122 内存不足，跳过...
⚠️  批次 123 内存不足，跳过...
⚠️  批次 124 内存不足，跳过...
⚠️  批次 125 内存不足，跳过...
⚠️  批次 126 内存不足，跳过...
⚠️  批次 127 内存不足，跳过...
⚠️  批次 128 内存不足，跳过...
⚠️  批次 129 内存不足，跳过...
⚠️  批次 130 内存不足，跳过...
⚠️  批次 131 内存不足，跳过...
⚠️  批次 132 内存不足，跳过...
Traceback (most recent call last):
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 396, in <module>
    main(**config_dic)
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 359, in main
    best_epoch, best_loss = train_model(
                            ^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 127, in train_model
    epoch_loss = train_epoch_model(model, train_loader, criterion, optimizer, device_1, device_2, device_3, val_loader, pbar)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/train.py", line 39, in train_epoch_model
    output, l, g, mu_l, sigma2_l, mu_g, sigma2_g = model(i_image, v_image, device_1, device_2, device_3)
                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/model.py", line 43, in forward
    l,mu_l,sigma2_l = self.I_encoder_decoder(i)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/model.py", line 17, in forward
    x=self.encoder(x)
      ^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/component.py", line 19, in forward
    x=self.model(x)
      ^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/container.py", line 240, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/../restormer/restormer_arch.py", line 248, in forward
    out_enc_level3 = self.encoder_level3(inp_enc_level3)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/container.py", line 240, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/../restormer/restormer_arch.py", line 141, in forward
    x = x + self.attn(self.norm1(x))
            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/1024_whs/IVfusion_method1/model/stage2/../restormer/restormer_arch.py", line 111, in forward
    q = rearrange(q, 'b (head c) h w -> b head c (h w)', head=self.num_heads)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/.local/lib/python3.11/site-packages/einops/einops.py", line 600, in rearrange
    return reduce(tensor, pattern, reduction="rearrange", **axes_lengths)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/.local/lib/python3.11/site-packages/einops/einops.py", line 532, in reduce
    return _apply_recipe(
           ^^^^^^^^^^^^^^
  File "/home/user/.local/lib/python3.11/site-packages/einops/einops.py", line 243, in _apply_recipe
    tensor = backend.reshape(tensor, init_shapes)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/.local/lib/python3.11/site-packages/einops/_backends.py", line 93, in reshape
    return x.reshape(shape)
           ^^^^^^^^^^^^^^^^
KeyboardInterrupt
